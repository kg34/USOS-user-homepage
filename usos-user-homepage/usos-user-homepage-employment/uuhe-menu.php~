<?php

function uuhe_menu_page_callback() {
	$add_code = uuh_menu_page_get_date_input('Start date', 'start_date').
				uuh_menu_page_get_date_input('End date', 'end_date');
	$add_fields = array(
		'company-name' => 'Company name',
		'link' => 'Company link',
		'job' => 'Job',
		);
	$add_atts = array (
		'title' => 'Add',
		'code' => $add_code,
		'page' => 'add_new_employment',
		'fields' => $add_fields
		);
	$find_code = '';
	$find_fields = array(
		'company-name' => 'Company name',
		'job' => 'Job',
		);
	$find_atts = array (
		'title' => 'Find',
		'code' => $find_code,
		'page' => 'find_employment',
		'fields' => $find_fields
		);
	$delete_fields = $find_fields;
	$delete_code = $find_code;
	$delete_atts = array (
		'title' => 'Delete',
		'code' => $delete_code,
		'page' => 'delete_employment',
		'fields' => $delete_fields
		);	
	$atts = array (
		'add' => $add_atts,
		'find' => $find_atts,
		'delete' => $delete_atts
		);
	$div_title = 'Alaska';

	uuh_menu_page_print_page($div_title, $atts);
}

add_action( 'admin_post_add_new_employment', 'uuhe_menu_page_add_employment' );
add_action( 'admin_post_find_employment', 'uuhe_menu_page_find_employment' );
add_action( 'admin_post_delete_employment', 'uuhe_menu_page_delete_employment' );

function uuhe_menu_page_add_employment() {
	$atts = array(
		'company-name' => 'text',
		'link' => 'text',
		'start_date' => 'date',
		'end_date' => 'date',
		'job' => 'text',
		);
	$result = uuh_menu_page_get_atts($atts);
	if ($result == NULL) {
		wp_die("Oszust");
		return;
	}
	$employment = array(
		'company_name' => $result['company-name'],
		'link' => $result['link'],
		'job' => $result['job'],
		'start_date' => $result['start_date'],
		'end_date' => $result['end_date'],
		'user_id' => wp_get_current_user()->ID,
	);
	
	if ($employment['company_name'] == '')
		$course['company_name'] = 'Company';
	uuhe_database_add_employment($employment);
	uuh_menu_page_post_header('Dodano');
	echo '<tr><td>'.$employment['company_name'].'</td><td>'.$employment['job'].'</td><td>'.$employment['start_date'].'</td><td>'.$employment['end_date'].'</td><td>'.$employment['link'].'</td></tr>';
	uuh_menu_page_post_footer();
}

function uuhe_menu_page_print_employment($message) {
	$atts = array(
		'company-name' => 'text',
		'job' => 'text',
		);
	$result = uuh_menu_page_get_atts($atts);
	if ($result == NULL) {
		echo "Oszust";
		return;
	}
	$employment_atts = array(
		'user_id' => wp_get_current_user()->ID,
	);
	if ($result['company_name'] != '')
		$employment_atts['company_name'] = $result['company_name'];
	if ($result['job'] != '')
		$employment_atts['job'] = $result['job'];
	$select_atts = array(
		'company_name' => true,
		'job' => true,
		'start_date' => true,
		'end_date' => true,
		'link' => true,
	);
	$employment = uuhe_database_get_employment($employment_atts, $select_atts);
	uuh_menu_page_post_header($message);
	foreach ( $employment as $emp ) {
		echo '<tr>';
		foreach ( $emp as $value )
			echo '<td>'.$value.'</td>';
		echo '</tr>';
	}
	uuh_menu_page_post_footer();
}

function uuhe_menu_page_delete_employment() {
	uuhe_menu_page_print_employment('Skasowano');
	$employment_atts = array(
		'user_id' => wp_get_current_user()->ID,
	);
	uuhe_database_delete_employment($course_atts);
}

function uuhe_menu_page_find_employment() {
	uuhe_menu_page_print_employment('Znaleziono');
}

function uuhe_menu_page_get_employment() {
	$select_atts = array(
		'employment_id' => true,
		'company_name' => true,
		'job' => true,
		'start_date' => true,
		'end_date' => true,
		'link' => true,
	);
	$employment = uuhe_database_get_user_employment(wp_get_current_user()->ID, $select_atts);
	print_r($employment);
	$fields = array();
	foreach ( $employment as $emp ) {
		$value = $emp['employment_id'];
		$emp['employment_id'] = '';
		$content = '';
		foreach ( $emp as $val )
			if (! $val == '')
				$content = $content.$val.' ';
		$fields[1] = array(
			'value' => $value,
			'content' => $content
		);
	}
	print_r($fields);
	echo 'ni';
	return array (
		'name' => 'employment',
		'title' => 'Employment',
		'fields' => $fields
	);
}
?>
